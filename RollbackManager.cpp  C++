#include "RollbackManager.h"

RollbackManager::RollbackManager()
{
    top = nullptr;
}

void RollbackManager::push(ParkingSlot* slot, ParkingRequest* req, RequestState prev)
{
    RollbackNode* node = new RollbackNode{slot, req, prev, top};
    top = node;
}

void RollbackManager::rollback(int k)
{
    while (k-- && top)
    {
        top->slot->release();
        top->request->transition(top->prevState);
        top = top->next;
    }
}
